# BCNF (Boyce-Codd正規化形式) 資料模型說明

BCNF (Boyce-Codd Normal Form) 是比3NF更嚴格的正規化形式，它解決了3NF中可能存在的某些特殊依賴問題。以下是BCNF的定義和應用說明：

## BCNF定義

資料表符合BCNF要求必須滿足：
- 資料表已經符合3NF
- **對於所有非平凡的函數依賴關係 X → Y，X必須是候選鍵 (Candidate Key)**

簡單來說，BCNF要求所有決定其他屬性的屬性集合都必須是候選鍵。

## 3NF與BCNF的差異

3NF允許某些非主鍵屬性決定其他屬性，只要被決定的屬性也依賴於主鍵。而BCNF則更加嚴格，要求所有決定其他屬性的屬性集合都**必須是表格的候選鍵**。

## BCNF的實例

假設我們有一個課程註冊表：
```
課程註冊(學生ID, 課程ID, 教授ID, 成績)
```

候選鍵：

- 學生ID
- 教授ID

其中：

- 一門課程只能由一位教授教授
- 一位教授可以教授多門課程
- 一位學生可以註冊多門課程

在這個例子中，有以下函數依賴：
- (學生ID, 課程ID) → 成績
- (學生ID, 課程ID) → 教授ID
- 課程ID → 教授ID

該表符合3NF，但不符合BCNF，因為「課程ID → 教授ID」這個依賴關係中，課程ID不是候選鍵。

### BCNF正規化

將上述表格分解為：
```
課程教授(課程ID, 教授ID)
學生成績(學生ID, 課程ID, 成績)
```

這樣每個表格都符合BCNF，因為所有**決定其他屬性的屬性都是候選鍵**。

## BCNF在露營用品銷售資料庫中的應用

以之前的露營用品銷售網站資料庫為例，讓我們檢查是否已符合BCNF：

### 潛在的BCNF問題情境

假設我們擴展原始設計，增加了一個情境：一個產品在特定時間只能由一個供應商供應，但供應商可以隨時間變化。

我們可能會有這樣的資料表：
```
產品供應歷史(產品ID, 日期, 供應商ID, 供應價格)
```

候選鍵：

- 產品ID
- 供應商ID

函數依賴：

- (產品ID, 日期) → 供應商ID
- (產品ID, 供應商ID, 日期) → 供應價格

這個表格符合3NF，但不符合BCNF，因為(產品ID, 日期)不是候選鍵，但它決定了供應商ID。

### BCNF解決方案

將其分解為：
```
產品供應商分配(產品ID, 日期, 供應商ID)
產品供應價格(產品ID, 供應商ID, 日期, 供應價格)
```

這樣每個表格都符合BCNF。

## BCNF的實務考量

1. **優點**：
   - 消除了更多的冗餘
   - 避免了更多可能的更新異常

2. **缺點**：
   - 可能會導致非保持依賴的分解（失去某些依賴關係）
   - 有時會增加查詢時的連接操作，影響效能

3. **使用建議**：
   - 對於**資料一致性要求較高的系統**，宜考慮BCNF
   - 在效能和正規化之間取得平衡
   - 有時可以接受部分表格保持在3NF而不執行BCNF

在實務上，許多資料庫設計師會直接設計符合BCNF的資料模型，但如果BCNF會導致查詢效能明顯下降，有時會選擇保留在3NF。