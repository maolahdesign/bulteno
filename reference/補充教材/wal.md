# WAL 檔案
 **Write-Ahead Logging (預寫式日誌)** 檔案的縮寫。它是一種在資料庫系統中廣泛使用的技術，用於保證資料的**原子性 (Atomicity)** 和 **持久性 (Durability)**，這兩個是 ACID 屬性的重要組成部分。

以下是關於 WAL 檔案更詳細的解釋：

**運作方式：**

當資料庫需要進行任何修改（例如插入、更新、刪除資料）時，它不會直接將這些變更寫入主要的資料檔案中。相反地，它會先將這些修改操作記錄到 WAL 檔案中。這個 WAL 檔案是一個循序寫入的日誌，記錄了所有資料變更的詳細資訊。

只有在相關的變更被成功地寫入 WAL 檔案並確認安全地儲存到磁碟上之後，資料庫才會真正地將這些變更應用到主要的資料檔案中。

**主要作用：**

* **保證資料持久性 (Durability)：** 即使在資料庫伺服器突然崩潰（例如斷電）的情況下，由於所有的修改操作都已經被記錄在 WAL 檔案中，資料庫在重新啟動後可以通過重新執行 WAL 檔案中的記錄，將資料庫恢復到崩潰前的最後一個一致狀態，確保已提交的交易不會遺失。
* **保證資料原子性 (Atomicity)：** WAL 記錄了每個交易的所有步驟。如果一個交易在完成之前崩潰，資料庫可以通過 WAL 檔案判斷哪些操作已經完成，哪些沒有完成，並在恢復時進行必要的復原（例如回滾未完成的交易），確保交易的完整性。
* **提高寫入效能：** 相較於直接寫入可能分散在磁碟各處的資料檔案，循序寫入 WAL 檔案通常更快，因為磁碟的循序寫入效能遠優於隨機寫入。資料庫可以先快速地將變更記錄到 WAL 中，然後在稍後的某個時間點再將這些變更批量地寫入主要的資料檔案，從而提高整體寫入效能。
* **支援時間點回復 (Point-in-Time Recovery, PITR)：** 通過保留 WAL 檔案的歷史記錄，資料庫可以回復到過去的某個特定時間點的狀態，這對於資料恢復和稽核非常有用。
* **支援資料庫複製 (Replication)：** WAL 檔案通常也用於資料庫的複製功能。備份伺服器可以讀取主伺服器的 WAL 檔案，並將其中的變更應用到自己的資料庫中，以保持資料同步。

**常見的 WAL 檔案名稱：**

不同的資料庫系統可能有不同的 WAL 檔案命名方式和擴展名。例如，在 PostgreSQL 中，WAL 檔案通常位於 `pg_wal` 目錄下，並以類似 `00000001000000000000000A` 的十六進位數字命名。在 SQLite 中，如果啟用 WAL 模式，則會產生一個 `.wal` 檔案。

**總結：**

WAL 檔案是現代資料庫系統中不可或缺的一部分，它通過預先記錄資料變更的方式，極大地提高了資料的可靠性、一致性和寫入效能，並提供了額外的資料恢復和複製能力。